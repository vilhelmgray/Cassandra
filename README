                               Cassandra

About
-----

Cassandra uses the Kelly criterion to determine the optimum betting
amount for a Texas hold 'em player during betting rounds.

Execution
---------

Cassandra handles only a single play of a poker hand; Cassandra must
be restarted for consecutive plays.

The first two prompts respectively request the player's current bankroll
and the retained pot of the current round; unsigned integer values are
expected. Even if the player has a blind (small or big) for the current
play, both the bankroll value and the pot value must reflect the state
of the game at the player's first turn to act -- i.e. after the blinds
have been posted.

The retained pot value is determined by multiplying the player's
previous bet amount by the number of bets placed by the opponents. Since
blinds are forced bets and result in a delayed first turn to act, the
retained pot value is only greater than zero when the player has a
blind; in all other situations, there are no previous bets placed by the
player when it is his or her first turn to act, so the retained pot
amount is 0 (0 * number_of_opponent_bets = 0).

Example 1:

    There are 4 opponents. The player has a bankroll of 5000 before
    the play of the hand. The betting order is such: Opponent 1,
    Opponent 2, Opponent 3, Player, and Opponent 4.

    Sample play:
        Opponent 1 posts small blind of 15.
        Opponent 2 posts big blind of 30.
        Opponent 3 raises 60.
        Player's turn to act.

    This is the point where Cassandra may be executed. The bankroll
    prompt input would be 5000 since the player has yet to place a
    bet. The pot prompt input would be 0 since the player has not
    made a previous bet.

Example 2:

    There are 4 opponents. The player has a bankroll of 5000 before
    the play of the hand. The betting order is such: Opponent 1,
    Player, Opponent 2, Opponent 3, and Opponent 4.

    Sample play:
        Opponent 1 posts small blind of 15.
        Player posts big blind of 30.
        Opponent 2 calls 30.
        Opponent 3 raises 60.
        Opponent 4 folds.
        Opponent 1 calls 45.
        Player's turn to act.

    This is the point where Cassandra may be executed. The bankroll
    prompt input would be 4970 since the player posted a blind of 30
    previously (5000 - 30 = 4970). The pot prompt input would be 90
    since the player's previous bet amount is 30 and the number of
    opponent bets since the player's last bet is 3 (30 * 3 = 90);
    only 3 opponents (Opponent 2, Opponent 3, and Opponent 1) placed
    bets since the player's previous bet (the big blind of 30). Note
    that Opponent 3's raise has no affect on the pot prompt input
    value -- it has the same effect as a call; in contrast,
    Opponent 4's fold did affect the pot prompt input value by being
    one less opponent bet to consider.

Example 3:

    There are 4 opponents. The player has a bankroll of 5000 before
    the play of the hand. The betting order is such: Player,
    Opponent 1, Opponent 2, Opponent 3, and Opponent 4.

    Sample play:
        Player posts small blind of 15.
        Opponent 1 posts big blind of 30.
        Opponent 2 calls 30.
        Opponent 3 folds.
        Opponent 4 folds.
        Player's turn to act.

    This is the point where Cassandra may be executed. The bankroll
    prompt input would be 4985 since the player posted a blind of 15
    previously (5000 - 15 = 4985). The pot prompt input would be 30
    since the player's previous bet amount is 15 and the number of
    opponent bets since the player's last bet is 2 (15 * 2 = 30);
    only 2 opponents (Opponent 1 and Opponent 2) placed bets since
    the player's previous bet (the small blind of 15).

At the start of each betting round, the relevant cards for that round
are requested. A single card is input at a time in a particular format:
the card rank followed by the card suit. The card rank is represented by
an unsigned integer between 1 and 13; where integers 2-10 correspond to
the respective card ranks -- and integers 1, 11, 12, and 13 correspond
to the Ace, Jack, Queen, and King card ranks respectively. The card suit
is represented by one of four characters; where the characters "c," "d,"
"h," and "s" correspond to the Club, Diamond, Heart, and Spade suits
respectively.

Example 4:
    
    The player is dealt the following hole cards: Queen of Diamond
    and the Three of Heart.

    Cassandra excerpt:
        ==Hole Cards==
        Input card: 12d
        Input card: 3h

    The Queen rank is represented by the integer "12," and the
    Diamond suit is represented by the character "d;" so the player
    inputs "12d" to represent the Queen of Diamond. The Three rank
    is represented by the integer "3," and the Heart suit is
    represented by the character "h;" so the player inputs "3h" to
    represent the Three of Heart.

Example 5:

    The player is dealt the following hole cards: Ace of Club and
    the Ace of Spade.

    Cassandra excerpt:
        ==Hole Cards==
        Input card: 1c
        Input card: 1s

    The Ace rank is represented by the integer "1," and the Club
    suit is represented by the character "c;" so the player inputs
    "1c" to represent the Ace of Club. The Ace rank is represented
    by the integer "1," and the Spade suit is represented by the
    character "s;" so the player inputs "1s" to represent the Ace of
    Spade.

At the start of every cycle of a betting round, the number of opponents
is requested and must be given as an unsigned integer. The probability
of the player winning the entire play of the current poker hand is
printed, as well as the suggested player bet amount for the current
turn to act. The player's actual bet amount is then requested and must
be given as an unsigned integer. The integer 0 for the bet amount prompt
is used to represent a check by the player, or the end of the betting
round.

Cassandra then requests the bet amount of each opponent; all opponent
bet amounts are expected as unsigned integers. An opponent check or fold
is represented by a respective bet amount of 0. After all opponent bet
amounts have been entered, the betting cycle repeats by requesting the
number of opponents again. At this point, the integer 0 may be entered
to end the betting round. At the end of the betting round, the current
pot value is printed. Next betting round, if any, begins after the
previous ends.

Example 6:

    It is the start of a cycle of the Flop betting round. The
    current pot is 100. There are 3 opponents. The player begins
    the cycle with a check.
    
    Cassandra excerpt:
        Number of Opponents: 3
        Win probability: 0.262085
        You should bet: 233
        Bet Ammount: 0
        Check? [Y/n]: y
        Player #3: 0
        Player #2: 50
        Player #1: 50
        Number of Opponents: 3
        Win probability: 0.262085
        You should bet: 302
        Bet Ammount: 50
        Player #3: 100
        Player #2: 0
        Player #1: 50
        Number of Opponents: 2
        Win probability: 0.409539
        You should bet: 845
        Bet Ammount: 50
        Player #2: 0
        Player #1: 0
        Number of Opponents: 0
        Pot: 450
        ==Turn==
        Input card:

    The betting round can be summed as such:
        Player checks.
        Opponent 3 checks.
        Opponent 2 raises 50.
        Opponent 1 calls 50.
        Player calls 50.
        Opponent 3 raises 100.
        Opponent 2 folds.
        Opponent 1 calls 50.
        Player calls 50.
        Flop betting round ends.
        Turn betting round begins.

    Notice how the player chose to bet less than the suggested
    betting amount in all three turns to act; a player does not have
    to bet the suggested betting amount. The number of opponents
    drops to 2 in the player's third turn to act since Opponent 2
    folded in the previous cycle. It is important to note that even
    though the betting round ends when the player calls in the
    player's third turn to act, 0 must be entered for each remaining
    opponent, since Cassandra lacks the ability to end the betting
    round at that point. Also note that the pot is adjusted
    automatically throughout the round, allowing the current pot
    value to be printed at the end (100 + 50+50+50+100+50+50 = 450).

Algorithm
---------

A 52-card deck is represented in memory as a 52-bit value, where each
bit represents a unique discrete card. The card suits are broken into
four groups of contiguous bits, where each group consists of 13 bits
respectively representing the 13 discrete cards of the suit.

The suits in order from least significant bit to most significant bit
are Club (bit 0 to bit 12), Diamond (bit 13 to bit 25), Heart (bit 26
to bit 38), and Spade (bit 39 to bit 51). Similarly, the card ranks are
ordered from least significant bit to most significant bit: Ace is
represented by the least significant bit, Two is represented by the next
bit, and the rest of the ranks onward by their respective bits, all the
way to King being represented by the most significant bit (12 bits from
the respective bit for the Ace rank); each card suit consists of its own
13 bits representing the respective 13 card ranks of that card suit.

Example 7:

    The Seven of Diamond is represented by bit 19.

    0000000000000 0000000000000 0000001000000 0000000000000

    Assuming the least significant bit is on the right, the Diamond
    suit is the second group of 13 bits from the right. The Seven
    rank is the seventh bit of its group, which in this case is bit
    19. In memory, this value would be 0x80000 (524288).

Since each bit represents a unique discrete card in a 52-card deck, any
legal hand may be represented by setting the respective bits for the
cards in the hand.

Example 8:

    The Jack of Club and Two of Heart are given as hole cards.

    0000000000000 0000000000010 0000000000000 0010000000000

    Assuming the least significant bit is on the right, the Club
    suit is the first group of 13 bits from the right, and the Heart
    suit is the third group of 13 bits from the right. The Two rank
    is the second bit of its group, and the Jack rank is the
    eleventh bit of its group. The Jack of Club is represented by
    bit 10, and the Two of Heart is represented by bit 27. Setting
    these two bits in memory results in the value 0x8000400
    (134218752).

The binary representation of a hand allows for efficient determination
of the hand rank via bitwise operations. A hand is initially assumed to
be of High Card rank (the lowest hand rank). The hand rank is determined
by analysing the binary representation of the hand for certain bitwise
criteria; the highest hand rank, whose bitwise criteria the binary
representative of the hand statisfies, is determined to be the hand's
rank. Most of the bitwise criteria are simple bitmask operations; this
method bypasses the usual latencies associated with traditional card
abstraction algorithms (e.g. typical object-oriented approaches
involving card classes).

There are 1326 (52 choose 2) possible combinations of hole cards which a
player may be dealt at the start of a play; 2 cards out of the 52 card
deck are chosen. This leaves 50 cards from which 5 are dealt as
community cards; there are 2118760 (50 choose 5) combinations of
community cards which are possible after the player's hole cards are
known. Finally, if the player's hole cards and the community cards are
known, there remains 990 (45 choose 2) combinations of possible hole
cards an opponent may have been dealt from the remaining 45 cards of
the deck.

Licensing
---------

Cassandra is free software released under version 3 of the GNU General
Public License.

See the file COPYING for copying conditions.

Contact
-------

William Breathitt Gray <vilhelm.gray@gmail.com>
